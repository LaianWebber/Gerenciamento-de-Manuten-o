<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- <script type="module" src="../scripts/index.js" defer></script> -->
    <link rel="stylesheet" href="../styles.css">
    <title>Document</title>
</head>

<body>
    <header>
        <img src="https://logodownload.org/wp-content/uploads/2016/10/sesi-logo.png" alt="Logo do Sesi">
    </header>

    <main id="mainTaskManager">
        <div id="containerAllTask">
            <section>
                <div id="headerAllTask">
                    <h1 id="title">Suas Tarefas</h1>
                    <div id="sair">
                        <a href="../index.html">
                            <h3>Sair</h3>
                        </a>
                        <i class="bi bi-x-square-fill"></i>
                    </div>
                </div>

                <div id="navAllTask">
                    <div>
                        <a href="./taskColab.html"><i class="bi bi-card-checklist"></i>Todos</a>
                    </div>

                    <div class="itemNavTask" id="quadroChecked">
                        <a href="./taskQuadroColab.html"><i class="bi bi-kanban"></i>Quadro</a>
                    </div>
                </div>
            </section>

            <section id="tableTasks">
                <div id="container" class="fazer">
                    <div id="headerFazer">
                        <span class="fazer">A fazer </span>
                        <h3 id="contFazer"></h3>
                    </div>

                    <!-- <div class="taskFazer">
                        <h2 class="tarefas">ðŸ“º<a href="#">Projetor com defeito</a></h2>
                        <h2 class="responsavel"><a href="#">Jorge - Ti</a></h2>
                        <span class="alta">Alta</span>
                    </div>

                    <div class="taskFazer">
                        <h2 class="tarefas">ðŸ”Œ<a href="#">Tomada nÃ£o funcionando</a></h2>
                        <h2 class="responsavel"><a href="#">Jorge - Ti</a></h2>
                        <span class="alta">Alta</span>
                    </div> -->

                    <a href="#" id="linkAddFazer">
                        <div id="AddFazer">
                            <i class="bi bi-plus-circle"></i>
                            <h2>Adicionar tarefa</h2>
                        </div>
                    </a>
                </div>



                <!--Container Andamento-->
                <div id="container" class="andamento">
                    <div id="headerFazer">
                        <span class="andamento">Em andamento</span>
                        <h3 id="contAndamento"></h3>
                    </div>

                    <!-- <div class="taskAndamento">
                        <h2 class="tarefas">ðŸ“º<a href="#">Projetor com defeito</a></h2>
                        <h2 class="responsavel"><a href="#">Jorge - Ti</a></h2>
                        <span class="alta">Alta</span>
                    </div>

                    <div class="taskAndamento">
                        <h2 class="tarefas">ðŸ“º<a href="#">Projetor com defeito</a></h2>
                        <h2 class="responsavel"><a href="#">Jorge - Ti</a></h2>
                        <span class="media">MÃ©dia</span>
                    </div>

                    <div class="taskAndamento">
                        <h2 class="tarefas">ðŸ“º<a href="#">Projetor com defeito</a></h2>
                        <h2 class="responsavel"><a href="#">Jorge - Ti</a></h2>
                        <span class="baixa">Baixa</span>
                    </div> -->

                    <a href="#" id="linkAddAndamento">
                        <div id="AddAndamento">
                            <i class="bi bi-plus-circle"></i>
                            <h2>Adicionar tarefa</h2>
                        </div>
                    </a>
                </div>

                <!-- Container concluida -->
                <div id="container" class="concluida">
                    <div id="headerFazer">
                        <span class="concluida">ConcluÃ­da</span>
                        <h3 id="contConcluida"></h3>
                    </div>

                    <!-- <div class="taskConcluida">
                        <h2 class="tarefas">ðŸ“º<a href="#">Projetor com defeito</a></h2>
                        <h2 class="responsavel"><a href="#">Jorge - Ti</a></h2>
                        <span class="alta">Alta</span>
                    </div>

                    <div class="taskConcluida">
                        <h2 class="tarefas">ðŸ“º<a href="#">Projetor com defeito</a></h2>
                        <h2 class="responsavel"><a href="#">Jorge - Ti</a></h2>
                        <span class="alta">Alta</span>
                    </div> -->

                    <a href="#" id="linkAddConcluida">
                        <div id="AddConcluida">
                            <i class="bi bi-plus-circle"></i>
                            <h2>Adicionar tarefa</h2>
                        </div>
                    </a>
                </div>

                <!-- Container arquivados -->
                <div id="container" class="arquivada">
                    <div id="headerFazer">
                        <span class="arquivada">Arquivadas</span>
                        <h3 id="contArquivada"></h3>
                    </div>

                    <!-- <div class="taskArquivada">
                        <h2 class="tarefas">ðŸ“º<a href="#">Projetor com defeito</a></h2>
                        <h2 class="responsavel"><a href="#">Jorge - Ti</a></h2>
                        <span class="alta">Alta</span>
                    </div> -->

                    <a href="#" id="linkAddArquivada">
                        <div id="AddArquivada">
                            <i class="bi bi-plus-circle"></i>
                            <h2>Adicionar tarefa</h2>
                        </div>
                    </a>
                </div>
            </section>
        </div>
    </main>

    <script>
        function storeTaskId(id) {
            console.log("Armazenando ID da tarefa: ", id); // Verifica se o ID estÃ¡ sendo passado corretamente
            localStorage.setItem('taskId', id);
        }
    </script>

    <script>

        let idUser = localStorage.getItem('idUser');

        // window.editStatus = function (idTask) {
        //     console.log(idTask);
        // };

        window.onload = () => {
            getUserName(idUser)
        }

        function getUserName(idUser) {
            fetch(`http://localhost:3000/user/${idUser}`)
                .then(response => {
                    if (response.status === 200) {
                        // console.log(response.json());
                        return response.json();
                    } else {
                        console.log('nok');
                    }
                })
                .then(data => {
                    console.log(data[0].username);
                    const username = data[0].username;
                    const title = document.querySelector('#title');
                    title.textContent += ` - ${username.charAt(0).toUpperCase() + username.slice(1)}`;
                    
                    getTask(username);
                });
        }

        // ----------------------------
        function getTask(username) {
            fetch(`http://localhost:3000/tasks`)
                .then(response => {
                    if (response.status === 200) {
                        return response.json();
                    } else {
                        console.log('nok');
                    }
                })
                .then(tarefas => {
                    if (tarefas.length === 0) {
                        document.querySelector('#tableTasks').style.display = 'none';
                        console.log("VocÃª nÃ£o tem tarefas");
                    } else {
                        let contadorFazer = 0;
                        let contadorAndamento = 0;
                        let contadorConcluida = 0;
                        let contadorArquivada = 0;

                        console.log(tarefas.length);

                        tarefas.forEach(tarefa => {
                            if (tarefa.task_respon == username) {
                                const containerFazer = document.querySelector('#container.fazer');
                                if (containerFazer) {
                                    if (tarefa.task_status === "a fazer") {
                                        let htmlTaskQuadroFazer = `
                                <div class="taskFazer">
                                    <h2 class="tarefas">ðŸ“º<a href="../pages/infoTask.html?source=taskQuadroColab" onclick="storeTaskId(${tarefa.id})">${tarefa.task_title}</a></h2>
                                    <h2 class="responsavel"><a href="#">${tarefa.task_respon.charAt(0).toUpperCase() + tarefa.task_respon.slice(1)}</a></h2>
                                    <span class="${tarefa.task_prior}">${tarefa.task_prior.charAt(0).toUpperCase() + tarefa.task_prior.slice(1)}</span>
                                </div>
                            `;
                                        containerFazer.innerHTML += htmlTaskQuadroFazer;

                                        const contFazer = document.querySelector('#contFazer');

                                        contadorFazer += 1;

                                        contFazer.textContent = contadorFazer;
                                    }
                                }


                                const containerAndamento = document.querySelector('#container.andamento');
                                if (containerAndamento) {
                                    if (tarefa.task_status === 'em andamento') {
                                        let htmlTaskQuadroAndamento = `
                                <div class="taskAndamento">
                                    <h2 class="tarefas">ðŸ“º<a href="../pages/infoTask.html?source=taskQuadroColab" onclick="storeTaskId(${tarefa.id})">${tarefa.task_title}</a></h2>
                                    <h2 class="responsavel"><a href="#">${tarefa.task_respon.charAt(0).toUpperCase() + tarefa.task_respon.slice(1)}</a></h2>
                                    <span class="${tarefa.task_prior}">${tarefa.task_prior.charAt(0).toUpperCase() + tarefa.task_prior.slice(1)}</span>
                                </div>
                            `;
                                        containerAndamento.innerHTML += htmlTaskQuadroAndamento;

                                        const contAndamento = document.querySelector('#contAndamento');

                                        contadorAndamento += 1;

                                        contAndamento.textContent = contadorAndamento;

                                    }
                                }

                                const containerConcluida = document.querySelector('#container.concluida');
                                if (containerConcluida) {
                                    if (tarefa.task_status === 'concluida') {
                                        let htmlTaskQuadroConcluido = `
                                <div class="taskConcluida">
                                    <h2 class="tarefas">ðŸ“º<a href="../pages/infoTask.html?source=taskQuadroColab" onclick="storeTaskId(${tarefa.id})">${tarefa.task_title}</a></h2>
                                    <h2 class="responsavel"><a href="#">${tarefa.task_respon.charAt(0).toUpperCase() + tarefa.task_respon.slice(1)}</a></h2>
                                    <span class="${tarefa.task_prior}">${tarefa.task_prior.charAt(0).toUpperCase() + tarefa.task_prior.slice(1)}</span>
                                </div>
                            `;
                                        containerConcluida.innerHTML += htmlTaskQuadroConcluido;

                                        const contConcluida = document.querySelector('#contConcluida');

                                        contadorConcluida += 1;

                                        contConcluida.textContent = contadorConcluida;
                                    }
                                }

                                const containerArquivado = document.querySelector('#container.arquivada');
                                if (containerArquivado) {
                                    if (tarefa.task_status === 'arquivada') {
                                        let htmlTaskQuadroArquivado = `
                                <div class="taskArquivada">
                                    <h2 class="tarefas">ðŸ“º<a href="../pages/infoTask.html?source=taskQuadroColab" onclick="storeTaskId(${tarefa.id})">${tarefa.task_title}</a></h2>
                                    <h2 class="responsavel"><a href="#">${tarefa.task_respon.charAt(0).toUpperCase() + tarefa.task_respon.slice(1)  }</a></h2>
                                    <span class="${tarefa.task_prior}">${tarefa.task_prior.charAt(0).toUpperCase() + tarefa.task_prior.slice(1)}</span>
                                </div>
                            `;
                                        containerArquivado.innerHTML += htmlTaskQuadroArquivado;

                                        const contArquivada = document.querySelector('#contArquivada');

                                        contadorArquivada += 1;

                                        contArquivada.textContent = contadorArquivada;
                                    }
                                }
                            }
                        });
                    }
                })
        }
    </script>
</body>

</html>